<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exponentialfunktionen Quiz</title>
    
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        #graph-container {
            width: 100%;
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .option-btn {
            background-color: #fff;
            border: 2px solid #007bff;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.2s;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 60px;
        }

        .option-btn:hover {
            background-color: #e7f1ff;
        }

        .option-btn.correct {
            background-color: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .option-btn.wrong {
            background-color: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        /* Feedback Bereich angepasst für Listen */
        #feedback-area {
            margin: 15px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border-left: 5px solid transparent;
            display: none; /* Standardmäßig ausblenden */
        }
        
        #feedback-area.visible {
            display: block;
            border-left-color: #007bff;
        }

        .feedback-title {
            font-size: 1.2em;
            font-weight: bold;
            display: block;
            margin-bottom: 10px;
            text-align: center;
        }

        .explanation-list {
            text-align: left;
            margin: 0;
            padding-left: 20px;
            color: #444;
        }

        .explanation-list li {
            margin-bottom: 5px;
            line-height: 1.5;
        }

        #next-btn {
            display: none;
            margin: 20px auto;
            padding: 10px 30px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.2em;
            cursor: pointer;
        }
        
        #progress {
            text-align: right;
            color: #666;
            margin-bottom: 10px;
        }

        .hidden { display: none; }
    </style>
</head>
<body>

<header>
    <h1>Exponentialfunktionen Quiz</h1>
    <p>Welche Funktionsgleichung gehört zum Graphen?</p>
</header>

<div id="quiz-container">
    <div id="progress">Aufgabe <span id="current-q">1</span> von 10</div>
    
    <div class="card">
        <div id="graph-container"></div>
    </div>

    <div id="feedback-area"></div>

    <div class="options-grid" id="options-container">
        </div>

    <button id="next-btn" onclick="nextQuestion()">Nächste Aufgabe</button>
</div>

<div id="end-screen" class="card hidden" style="text-align: center;">
    <h2>Quiz beendet!</h2>
    <p>Du hast <span id="final-score"></span> von 10 Aufgaben richtig gelöst.</p>
    <button class="option-btn" onclick="location.reload()" style="margin: 20px auto; width: auto; padding: 10px 30px;">Neustart</button>
</div>

<script>
    // --- Konfiguration der 10 Level mit detaillierten Erklärungen ---
    const levels = [
        { 
            a: 1, b: 2, c: 1, d: 0, 
            explanation: `
                <li><b>d = 0:</b> Die Asymptote ist die x-Achse.</li>
                <li><b>b = 2:</b> Die Basis ist > 1, daher exponentielles Wachstum.</li>
                <li><b>a = 1:</b> Der Graph geht durch (0|1) und ist nicht gestreckt.</li>`
        },
        { 
            a: 1, b: 0.5, c: 1, d: 0, 
            explanation: `
                <li><b>b = 0,5:</b> Die Basis liegt zwischen 0 und 1. Das bedeutet Zerfall (der Graph fällt).</li>
                <li><b>d = 0:</b> Die Asymptote ist die x-Achse.</li>`
        },
        { 
            a: 1, b: 2, c: 1, d: 3, 
            explanation: `
                <li><b>d = 3:</b> Der gesamte Graph ist um 3 nach oben verschoben. Die Asymptote liegt bei y = 3.</li>
                <li><b>b = 2:</b> Der Graph wächst nach oben weg.</li>`
        },
        { 
            a: -1, b: 2, c: 1, d: 0, 
            explanation: `
                <li><b>a = -1:</b> Das Vorzeichen ist negativ. Der Graph ist an der x-Achse gespiegelt und verläuft nach unten.</li>
                <li><b>b = 2:</b> Die Basis sorgt für Wachstum (in den negativen Bereich).</li>`
        },
        { 
            a: 1, b: 3, c: -1, d: 0, 
            explanation: `
                <li><b>c = -1:</b> Das Minus im Exponenten spiegelt den Graphen an der y-Achse. Aus Wachstum wird Zerfall.</li>
                <li><b>b = 3:</b> Die Kurve ist steiler als bei Basis 2.</li>`
        },
        { 
            a: 2, b: 1.5, c: 1, d: -2, 
            explanation: `
                <li><b>d = -2:</b> Die Asymptote ist um 2 nach unten verschoben (y = -2).</li>
                <li><b>a = 2:</b> Streckung! Der Schnittpunkt mit der y-Achse liegt nicht 1 Einheit, sondern 2 Einheiten über der Asymptote (bei y = 0).</li>`
        },
        { 
            a: -2, b: 2, c: 1, d: 4, 
            explanation: `
                <li><b>d = 4:</b> Die Asymptote liegt oben bei y = 4.</li>
                <li><b>a = -2:</b> Spiegelung und Streckung. Der Graph verläuft unterhalb der Asymptote und startet bei y = 2 (4 - 2).</li>`
        },
        { 
            a: 0.5, b: 4, c: 1, d: 1, 
            explanation: `
                <li><b>d = 1:</b> Die Asymptote liegt bei y = 1.</li>
                <li><b>a = 0,5:</b> Stauchung. Der Graph startet sehr flach, nur 0,5 Einheiten über der Asymptote.</li>
                <li><b>b = 4:</b> Sehr steiles Wachstum danach.</li>`
        },
        { 
            a: 1, b: 2, c: -1, d: -4, 
            explanation: `
                <li><b>d = -4:</b> Die Asymptote liegt tief unten bei y = -4.</li>
                <li><b>c = -1:</b> Durch das Minus im Exponenten fällt der Graph von links oben kommend zur Asymptote hin ab.</li>`
        },
        { 
            a: -1, b: 0.5, c: 1, d: 2, 
            explanation: `
                <li><b>d = 2:</b> Asymptote bei y = 2.</li>
                <li><b>b = 0,5:</b> Eigentlich Zerfall, aber...</li>
                <li><b>a = -1:</b> ...durch die Spiegelung steigt der Graph von unten kommend gegen die Asymptote.</li>`
        }
    ];

    let currentLevelIndex = 0;
    let score = 0;
    let canClick = true;

    // Hilfsfunktion: Latex String generieren
    function generateLatex(p) {
        let str = "y = ";
        if (p.a === -1) str += "-";
        else if (p.a !== 1) str += p.a + " \\cdot ";
        
        str += p.b;
        str += "^{";
        if (p.c === -1) str += "-x";
        else if (p.c !== 1) str += p.c + "x";
        else str += "x";
        str += "}";
        
        if (p.d > 0) str += " + " + p.d;
        else if (p.d < 0) str += " - " + Math.abs(p.d);
        
        return "$$" + str + "$$";
    }

    // Hilfsfunktion: Zufällige falsche Parameter erzeugen
    function generateDistractors(correct) {
        let options = [];
        options.push({ ...correct, correct: true }); 

        const variations = [
            p => ({ ...p, a: -p.a }), // Vorzeichenfehler a
            p => ({ ...p, d: -p.d }), // Vorzeichenfehler d
            p => ({ ...p, b: p.b === 2 ? 0.5 : (p.b === 0.5 ? 2 : (p.b + 1)) }), 
            p => ({ ...p, c: -p.c }), 
            p => ({ ...p, a: p.d !== 0 ? p.d : p.a + 1, d: p.a }), 
            p => ({ ...p, d: p.d + 2 }), 
            p => ({ ...p, a: p.a * 2 }) 
        ];

        let usedLatex = new Set();
        usedLatex.add(generateLatex(correct));

        let count = 0;
        let attempt = 0;
        while (count < 5 && attempt < 50) {
            let func = variations[attempt % variations.length];
            let fake = func(correct);
            let latex = generateLatex(fake);
            if (!usedLatex.has(latex)) {
                options.push({ ...fake, correct: false });
                usedLatex.add(latex);
                count++;
            }
            attempt++;
        }
        return options.sort(() => Math.random() - 0.5);
    }

    function plotGraph(p) {
        let xValues = [];
        let yValues = [];
        let asymptote = [];
        let step = 0.1;
        for (let x = -6; x <= 6; x += step) {
            xValues.push(x);
            let y = p.a * Math.pow(p.b, p.c * x) + p.d;
            yValues.push(y);
            asymptote.push(p.d);
        }

        let layout = {
            margin: { t: 20, r: 20, b: 40, l: 40 },
            xaxis: { title: 'x', zeroline: true, zerolinewidth: 3, gridcolor: '#eee', dtick: 1 },
            yaxis: { 
                title: 'y', zeroline: true, zerolinewidth: 3, gridcolor: '#eee',
                range: [Math.min(-5, p.d - 5), Math.max(10, p.d + 10)]
            },
            showlegend: false,
            hovermode: false 
        };

        let trace1 = { x: xValues, y: yValues, mode: 'lines', line: { color: '#007bff', width: 3 } };
        let trace2 = { x: xValues, y: asymptote, mode: 'lines', line: { color: '#ff0000', width: 1, dash: 'dash' } };

        Plotly.newPlot('graph-container', [trace1, trace2], layout, {staticPlot: false, displayModeBar: false});
    }

    function loadQuestion() {
         if (currentLevelIndex >= levels.length) {
            showEndScreen();
            return;
        }

        document.getElementById('current-q').innerText = currentLevelIndex + 1;
        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('feedback-area').innerHTML = '';
        document.getElementById('feedback-area').classList.remove('visible');
        canClick = true;

        const currentParams = levels[currentLevelIndex];
        plotGraph(currentParams);
        const options = generateDistractors(currentParams);
        const container = document.getElementById('options-container');
        container.innerHTML = '';

        options.forEach((opt) => {
            const btn = document.createElement('div');
            btn.className = 'option-btn';
            btn.innerHTML = generateLatex(opt);
            btn.dataset.isCorrect = opt.correct; 
            
            btn.onclick = () => {
                if (!canClick) return;
                canClick = false;
                
                let feedbackHTML = "";
                
                if (opt.correct) {
                    btn.classList.add('correct');
                    feedbackHTML = '<span class="feedback-title" style="color:green">Richtig! Analyse:</span>';
                    score++;
                } else {
                    btn.classList.add('wrong');
                    feedbackHTML = '<span class="feedback-title" style="color:red">Falsch. Hier ist die Analyse:</span>';
                    // Richtige Antwort finden und markieren
                    const all = document.querySelectorAll('.option-btn');
                    all.forEach(b => {
                        if (b.dataset.isCorrect === "true") {
                            b.classList.add('correct');
                        }
                    });
                }

                // Strukturierte Erklärung hinzufügen
                feedbackHTML += `<ul class="explanation-list">${currentParams.explanation}</ul>`;
                
                const fbArea = document.getElementById('feedback-area');
                fbArea.innerHTML = feedbackHTML;
                fbArea.classList.add('visible');

                document.getElementById('next-btn').style.display = 'block';
            };
            container.appendChild(btn);
        });
        MathJax.typesetPromise();
    }

    function nextQuestion() {
        currentLevelIndex++;
        loadQuestion();
    }

    function showEndScreen() {
        document.getElementById('quiz-container').classList.add('hidden');
        document.getElementById('end-screen').classList.remove('hidden');
        document.getElementById('final-score').innerText = score;
    }

    // Start
    loadQuestion();

</script>

</body>
</html>
