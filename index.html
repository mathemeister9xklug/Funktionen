<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kosinus-Funktions-Master</title>
    
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            max-width: 1000px; 
            margin: 0 auto; 
            padding: 20px; 
            background-color: #f0f2f5; 
            color: #333; 
        }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 10px; }
        .subtitle { text-align: center; margin-bottom: 30px; font-size: 1.1em; }

        /* Layout Container */
        .layout-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            align-items: start;
        }

        @media (max-width: 800px) {
            .layout-grid { grid-template-columns: 1fr; }
        }

        /* Anleitungskarte */
        .guide-card {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border-left: 5px solid #3498db;
            height: fit-content;
        }
        .guide-step { margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .guide-step:last-child { border-bottom: none; }
        .guide-title { font-weight: bold; color: #2980b9; display: block; margin-bottom: 5px; }

        /* Aufgabenkarte */
        .task-card { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
            min-height: 400px;
        }
        
        canvas { 
            border: 1px solid #ddd; 
            background-color: #fff; 
            display: block; 
            margin: 0 auto 20px auto; 
            border-radius: 4px; 
            width: 100%;
            max-width: 600px;
            height: auto;
        }

        .options-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            margin-top: 20px; 
        }

        button { 
            padding: 15px; 
            font-size: 16px; 
            cursor: pointer; 
            border: 2px solid #bdc3c7; 
            background: white; 
            color: #2c3e50; 
            border-radius: 8px; 
            transition: all 0.2s; 
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 60px;
        }
        button:hover { border-color: #3498db; background: #f7f9fc; }
        button:disabled { cursor: default; pointer-events: none; }
        
        /* Styles für Ergebnisse */
        button.correct { 
            background: #d4edda !important; 
            border-color: #27ae60 !important; 
            color: #155724 !important; 
            font-weight: bold;
        }
        button.wrong { 
            background: #f8d7da !important; 
            border-color: #e74c3c !important; 
            color: #721c24 !important; 
            opacity: 0.6; 
        }

        .feedback { margin-top: 20px; padding: 15px; border-radius: 8px; display: none; }
        .feedback.success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .feedback.error { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        
        .solution-box {
            font-size: 1.2em;
            margin: 10px 0;
            padding: 10px;
            background: rgba(255,255,255,0.6);
            border-radius: 5px;
            text-align: center;
            border: 1px solid rgba(0,0,0,0.1);
        }

        .nav-btn { 
            margin-top: 20px; 
            background: #2c3e50; 
            color: white; 
            border: none; 
            width: 100%; 
            padding: 15px;
            font-weight: bold;
            cursor: pointer;
        }
        .nav-btn:hover { background: #34495e; color: white; }

        /* End Screen Styles */
        .result-container {
            text-align: center;
            padding: 40px 20px;
        }
        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: #3498db;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            font-weight: bold;
            margin: 0 auto 20px auto;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.4);
        }
        .score-text { font-size: 1.2em; margin-bottom: 20px; }
        .restart-btn { background: #27ae60; border: none; color: white; padding: 15px 30px; font-size: 1.1em; border-radius: 5px; cursor: pointer; }
        .restart-btn:hover { background: #219150; }
    </style>
</head>
<body>

    <h1>Kosinus-Funktions-Master</h1>
    <div class="subtitle">
        Finde die Parameter für: \( f(x) = a \cdot \cos(b(x - c)) + d \)
    </div>

    <div class="layout-grid">
        
        <div class="guide-card">
            <h3>Anleitung</h3>
            
            <div class="guide-step">
                <span class="guide-title">Schritt 1: Parameter \(d\) (Verschiebung y)</span>
                Suche die Mitte zwischen Hoch- und Tiefpunkt.
                $$d = \frac{y_{max} + y_{min}}{2}$$
            </div>

            <div class="guide-step">
                <span class="guide-title">Schritt 2: Parameter \(a\) (Amplitude)</span>
                Miss den Abstand von der Mitte zum Hochpunkt.
                $$a = y_{max} - d$$
            </div>

            <div class="guide-step">
                <span class="guide-title">Schritt 3: Parameter \(b\) (Frequenz)</span>
                Bestimme die Länge einer Periode \(P\) (Berg zu Berg).
                $$b = \frac{2\pi}{P}$$
            </div>

            <div class="guide-step">
                <span class="guide-title">Schritt 4: Parameter \(c\) (Verschiebung x)</span>
                Wo ist der Start-Hochpunkt? 
                <br>Direkt auf der y-Achse: \(c=0\).
                <br>Rechts davon: \(c > 0\).
            </div>
        </div>

        <div id="quiz-container" class="task-card">
            </div>

    </div>

    <script>
        // --- Quiz Daten ---
        const problems = [
            { a: 2, b: 1, c: 0, d: 1, reason: "Mittelwert zwischen 3 und -1 ist 1 (d=1). Amplitude ist 2. Periode ist 2π (b=1)." },
            { a: 1, b: 2, c: 0, d: 0, reason: "Periode ist nur π lang, also b = 2π/π = 2." },
            { a: 3, b: 1, c: 0, d: -2, reason: "Tief verschoben auf d=-2. Große Amplitude a=3." },
            { a: 1.5, b: 0.5, c: 0, d: 0, reason: "Sehr langgezogene Welle. Periode ist 4π, also b = 0.5." },
            { a: 1, b: 1, c: Math.PI, d: 0, reason: "Der Hochpunkt ist bei x=π. Also Verschiebung c=π." },
            { a: 2, b: 1, c: Math.PI/2, d: 1, reason: "Hochpunkt nach rechts verschoben auf π/2." },
            { a: 0.5, b: 2, c: 0, d: 2, reason: "Kleine Welle (a=0.5), schnell (b=2), weit oben (d=2)." },
            { a: 2, b: 0.5, c: -Math.PI, d: -1, reason: "Langsame Welle, Startpunkt nach links verschoben (oder weit rechts)." },
            { a: 1, b: 1, c: 0, d: 3, reason: "Standard-Kosinus, nur hochgeschoben auf d=3." },
            { a: 1.5, b: 2, c: Math.PI/2, d: -1.5, reason: "Kombination aller Parameter: Schnell, verschoben und Amplitude angepasst." }
        ];

        let currentProblemIndex = 0;
        let score = 0; 

        // --- Mathe Hilfsfunktionen ---
        function formatVal(val) {
            if (val === 0) return 0;
            if (Math.abs(val - Math.PI) < 0.05) return "\\pi";
            if (Math.abs(val - Math.PI/2) < 0.05) return "\\frac{\\pi}{2}";
            if (Math.abs(val - (-Math.PI)) < 0.05) return "-\\pi";
            return Number(val.toFixed(2));
        }

        function generateLatex(a, b, c, d) {
            let str = "f(x) = ";
            
            if (a === -1) str += "-";
            else if (a !== 1) str += a;
            
            str += "\\cos(";
            
            if (b !== 1) {
                if (b === 0.5) str += "0.5";
                else str += b;
                str += "\\cdot ";
            }

            let innerContent = "x";
            if (c !== 0) {
                if (c > 0) innerContent += " - " + formatVal(c);
                else innerContent += " + " + formatVal(Math.abs(c));
                
                if (b !== 1) str += "(" + innerContent + ")";
                else str += innerContent;
            } else {
                 if (b !== 1) str += "x"; 
                 else str += "x";        
            }
            
            str += ")";
            
            if (d !== 0) {
                if (d > 0) str += " + " + d;
                else str += " - " + Math.abs(d);
            }
            
            return `$$${str}$$`;
        }

        // --- Distraktoren ---
        function generateOptions(correct) {
            let opts = [];
            opts.push(correct);
            opts.push({ ...correct, d: correct.d * -1 || 1 }); 
            opts.push({ ...correct, b: correct.b === 1 ? 2 : (correct.b === 2 ? 0.5 : 1) }); 
            opts.push({ ...correct, a: correct.a + 1 }); 
            opts.push({ ...correct, c: correct.c === 0 ? Math.PI/2 : 0 }); 
            opts.push({ ...correct, a: correct.a === 1 ? 2 : 1, d: correct.d + 1 }); 
            return opts.sort(() => Math.random() - 0.5);
        }

        // --- Graph Zeichnen ---
        function drawGraph(canvasId, p) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            const w = canvas.width;
            const h = canvas.height;
            const scaleX = 50; 
            const scaleY = 40; 
            const offsetX = 60; 
            const offsetY = h / 2; 

            ctx.clearRect(0, 0, w, h);
            ctx.beginPath();
            ctx.strokeStyle = "#f0f0f0";
            ctx.lineWidth = 1;
            for(let y = offsetY; y < h; y+=scaleY) { ctx.moveTo(0, y); ctx.lineTo(w, y); }
            for(let y = offsetY; y > 0; y-=scaleY) { ctx.moveTo(0, y); ctx.lineTo(w, y); }
            const piStep = Math.PI * scaleX / 2; 
            for(let x = offsetX; x < w; x+=piStep) { ctx.moveTo(x, 0); ctx.lineTo(x, h); }
            ctx.stroke();

            ctx.beginPath();
            ctx.strokeStyle = "#333";
            ctx.lineWidth = 2;
            ctx.moveTo(0, offsetY); ctx.lineTo(w, offsetY);
            ctx.moveTo(offsetX, 0); ctx.lineTo(offsetX, h);
            ctx.stroke();

            ctx.font = "14px Arial";
            ctx.fillStyle = "#555";
            ctx.textAlign = "center";
            for(let i = -4; i <= 4; i++) {
                if(i===0) continue;
                ctx.fillText(i, offsetX - 20, offsetY - (i * scaleY) + 5);
            }
            ctx.fillText("π", offsetX + Math.PI*scaleX, offsetY + 20);
            ctx.fillText("2π", offsetX + 2*Math.PI*scaleX, offsetY + 20);

            ctx.beginPath();
            ctx.strokeStyle = "#e74c3c";
            ctx.lineWidth = 3;
            for (let px = 0; px < w; px++) {
                let x = (px - offsetX) / scaleX;
                let y = p.a * Math.cos(p.b * (x - p.c)) + p.d;
                let py = offsetY - (y * scaleY);
                if (px === 0) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            }
            ctx.stroke();
        }

        // --- Hauptlogik ---
        function loadProblem() {
            const container = document.getElementById('quiz-container');
            container.innerHTML = ''; 

            if (currentProblemIndex >= problems.length) {
                showResults(container);
                return;
            }

            const p = problems[currentProblemIndex];
            const correctLatex = generateLatex(p.a, p.b, p.c, p.d);
            
            const header = document.createElement('h2');
            header.innerText = `Aufgabe ${currentProblemIndex + 1} von ${problems.length}`;
            header.style.marginTop = "0";
            container.appendChild(header);

            const canvas = document.createElement('canvas');
            canvas.id = 'graphCanvas';
            canvas.width = 600;
            canvas.height = 350; 
            container.appendChild(canvas);

            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'options-grid';
            
            const options = generateOptions(p);
            
            options.forEach(opt => {
                const btn = document.createElement('button');
                const latex = generateLatex(opt.a, opt.b, opt.c, opt.d);
                btn.innerHTML = latex; 
                
                // Wir speichern, ob das die richtige Antwort ist direkt im Button
                const isCorrectOption = (opt.a === p.a && opt.b === p.b && opt.c === p.c && opt.d === p.d);
                if (isCorrectOption) {
                    btn.dataset.isCorrect = "true";
                }

                btn.onclick = () => {
                    const allBtns = optionsDiv.querySelectorAll('button');
                    allBtns.forEach(b => b.disabled = true);
                    
                    const feedback = document.getElementById('feedbackArea');
                    const nextBtn = document.getElementById('nextBtn');
                    
                    let message = "";
                    let cssClass = "";

                    if (isCorrectOption) {
                        btn.className = 'correct'; 
                        score++; 
                        cssClass = 'feedback success';
                        message = `<strong>Richtig!</strong>`;
                    } else {
                        btn.className = 'wrong';
                        
                        // Hier ist der Fix: Wir suchen den Button mit dem "isCorrect" Marker
                        allBtns.forEach(b => {
                            if(b.dataset.isCorrect === "true") {
                                b.className = 'correct';
                            }
                        });
                        
                        cssClass = 'feedback error';
                        message = `<strong>Leider falsch.</strong>`;
                    }

                    feedback.className = cssClass;
                    feedback.innerHTML = `
                        ${message}
                        <div class="solution-box">
                            Die Lösung ist:<br>
                            ${correctLatex}
                        </div>
                        <strong>Erklärung:</strong> ${p.reason}
                    `;

                    feedback.style.display = 'block';
                    nextBtn.style.display = 'block'; 
                    MathJax.typesetPromise([feedback]);
                };
                optionsDiv.appendChild(btn);
            });
            container.appendChild(optionsDiv);

            const fb = document.createElement('div');
            fb.id = 'feedbackArea';
            fb.className = 'feedback';
            container.appendChild(fb);

            const nextBtn = document.createElement('button');
            nextBtn.id = 'nextBtn';
            nextBtn.className = 'nav-btn';
            
            if (currentProblemIndex === problems.length - 1) {
                nextBtn.innerText = "Ergebnis anzeigen →";
            } else {
                nextBtn.innerText = "Nächste Aufgabe →";
            }
            
            nextBtn.style.display = 'none'; 
            nextBtn.onclick = () => {
                currentProblemIndex++;
                loadProblem();
            };
            container.appendChild(nextBtn);

            drawGraph('graphCanvas', p);
            MathJax.typesetPromise();
        }

        function showResults(container) {
            container.innerHTML = `
                <div class="result-container">
                    <h2>Quiz beendet!</h2>
                    <p class="score-text">Deine Erfolgsquote:</p>
                    <div class="score-circle">
                        ${score} / ${problems.length}
                    </div>
                    <p>
                        Du hast <strong>${score}</strong> von <strong>${problems.length}</strong> Aufgaben beim ersten Versuch richtig gelöst.
                    </p>
                    <button class="restart-btn" onclick="location.reload()">Nochmal spielen</button>
                </div>
            `;
        }

        window.onload = loadProblem;

    </script>
</body>
</html>
